SkyEngine.Node=CLASS({init:(e,n,t)=>{let i,o,c,a,r,l,g,d,u,f,S,s,R,h,E,v,p,y,k,C,X,D,Y,w,I,m,A,T,x,M,O,P,H,V,N,L,W,F,U,b,_,B,K,q,Z,z,G,J,j,Q,$,ee,ne,te,ie,oe,ce,ae,re=[],le=!1,ge=!1,de={},ue=[],fe=[],Se=[],se={},Re={},he={},Ee=()=>{if(void 0===ee)b=i,_=o,B=i,K=o;else{let e=i*ee.getRealScaleX(),n=o*ee.getRealScaleY();b=ee.getDrawingX()+e*ee.getRealCos()-n*ee.getRealSin(),_=ee.getDrawingY()+e*ee.getRealSin()+n*ee.getRealCos();let t=a*q,c=r*Z;B=b-t*J+c*G,K=_-t*G-c*J}},ve=(n.setX=(e=>{i=e,Ee()}),n.getX=(()=>{return i}),n.setY=(e=>{o=e,Ee()}),n.getY=(()=>{return o}),n.setZ=(e=>{void 0!==$&&(Me(),c=e,xe())})),pe=(n.getZ=(()=>{return c}),n.setPosition=(e=>{void 0!==e.x&&(i=e.x),void 0!==e.y&&(o=e.y),void 0===e.x&&void 0===e.y||Ee(),void 0!==e.z&&ve(e.x)}),n.setCenterX=(e=>{a=e}),n.getCenterX=(()=>{return a}),n.setCenterY=(e=>{r=e}),n.getCenterY=(()=>{return r}),n.setSpeedX=(e=>{f=e}),n.getSpeedX=(()=>{return f}),n.setSpeedY=(e=>{S=e}),n.getSpeedY=(()=>{return S}),n.setAccelX=(e=>{v=e}),n.getAccelX=(()=>{return v}),n.setAccelY=(e=>{p=e}),n.getAccelY=(()=>{return p}),n.setMinSpeedX=(e=>{D=e}),n.getMinSpeedX=(()=>{return D}),n.setMinSpeedY=(e=>{Y=e}),n.getMinSpeedY=(()=>{return Y}),n.setMaxSpeedX=(e=>{T=e}),n.getMaxSpeedX=(()=>{return T}),n.setMaxSpeedY=(e=>{x=e}),n.getMaxSpeedY=(()=>{return x}),n.setToX=(e=>{V=e}),n.getToX=(()=>{return V}),n.setToY=(e=>{N=e}),n.getToY=(()=>{return N}),n.setScaleX=(e=>{l=e,q=void 0===ee?l:ee.getRealScaleX()*l})),ye=(n.getScaleX=(()=>{return l}),n.setScaleY=(e=>{g=e,Z=void 0===ee?e:ee.getRealScaleY()*g})),ke=(n.getScaleY=(()=>{return g}),n.setScale=(e=>{pe(e),ye(e)})),Ce=(n.setScalingSpeedX=(e=>{s=e}),n.getScalingSpeedX=(()=>{return s}),n.setScalingSpeedY=(e=>{R=e}),n.getScalingSpeedY=(()=>{return R}),n.setScalingSpeed=(e=>{s=e,R=e})),Xe=(n.setScalingAccelX=(e=>{y=e}),n.getScalingAccelX=(()=>{return y}),n.setScalingAccelY=(e=>{k=e}),n.getScalingAccelY=(()=>{return k}),n.setScalingAccel=(e=>{y=e,k=e})),De=(n.setMinScalingSpeedX=(e=>{w=e}),n.getMinScalingSpeedX=(()=>{return w}),n.setMinScalingSpeedY=(e=>{I=e}),n.getMinScalingSpeedY=(()=>{return I}),n.setMinScalingSpeed=(e=>{w=e,I=e}),n.setMaxScalingSpeedX=(e=>{M=e}),n.getMaxScalingSpeedX=(()=>{return M}),n.setMaxScalingSpeedY=(e=>{O=e}),n.getMaxScalingSpeedY=(()=>{return O}),n.setMaxScalingSpeed=(e=>{M=e,O=e}),n.setToScaleX=(e=>{L=e}),n.getToScaleX=(()=>{return L}),n.setToScaleY=(e=>{W=e}),n.getToScaleY=(()=>{return W}),n.setToScale=(e=>{L=e,W=e})),Ye=n.setAngle=(e=>{d=e,z=void 0===ee?d*Math.PI/180:ee.getRealRadian()+d*Math.PI/180,G=Math.sin(z),J=Math.cos(z)}),we=(n.getAngle=(()=>{return d}),n.setRotationSpeed=(e=>{h=e}),n.getRotationSpeed=(()=>{return h}),n.setRotationAccel=(e=>{C=e}),n.getRotationAccel=(()=>{return C}),n.setMinRotationSpeed=(e=>{m=e}),n.getMinRotationSpeed=(()=>{return m}),n.setMaxRotationSpeed=(e=>{P=e}),n.getMaxRotationSpeed=(()=>{return P}),n.setToAngle=(e=>{F=e}),n.getToAngle=(()=>{return F}),n.setAlpha=(e=>{u=e}),n.getAlpha=(()=>{return u}),n.setFadingSpeed=(e=>{E=e}),n.getFadingSpeed=(()=>{return E}),n.setFadingAccel=(e=>{X=e}),n.getFadingAccel=(()=>{return X}),n.setMinFadingSpeed=(e=>{A=e}),n.getMinFadingSpeed=(()=>{return A}),n.setMaxFadingSpeed=(e=>{H=e}),n.getMaxFadingSpeed=(()=>{return H}),n.setToAlpha=(e=>{U=e}),n.getToAlpha=(()=>{return U}),n.getDrawingX=(()=>{return B}),n.getDrawingY=(()=>{return K}),n.getRealX=(()=>{return b}),n.getRealY=(()=>{return _}),n.getRealScaleX=(()=>{return q}),n.getRealScaleY=(()=>{return Z}),n.getRealRadian=(()=>{return z}),n.getRealSin=(()=>{return G}),n.getRealCos=(()=>{return J}),n.getBeforeX=(()=>{return j}),n.getBeforeY=(()=>{return Q}),()=>{Ye(d),pe(l),ye(g),Ee()});void 0!==t&&(i=t.x,o=t.y,a=t.centerX,r=t.centerY,c=t.z,void 0!==t.scale&&ke(t.scale),void 0!==t.scaleX&&(l=t.scaleX),void 0!==t.scaleY&&(g=t.scaleY),d=t.angle,u=t.alpha,f=t.speedX,S=t.speedY,void 0!==t.scalingSpeed&&Ce(t.scalingSpeed),void 0!==t.scalingSpeedX&&(s=t.scalingSpeedX),void 0!==t.scalingSpeedY&&(R=t.scalingSpeedY),h=t.rotationSpeed,E=t.fadingSpeed,v=t.accelX,p=t.accelY,void 0!==t.scalingAccel&&Xe(t.scalingAccel),void 0!==t.scalingAccelX&&(y=t.scalingAccelX),void 0!==t.scalingAccelY&&(k=t.scalingAccelY),C=t.rotationAccel,X=t.fadingAccel,D=t.minSpeedX,Y=t.minSpeedY,void 0!==t.minScaleSpeed&&setMinScaleSpeed(t.minScaleSpeed),void 0!==t.minScaleSpeedX&&(minScaleSpeedX=t.minScaleSpeedX),void 0!==t.minScaleSpeedY&&(minScaleSpeedY=t.minScaleSpeedY),m=t.minRotationSpeed,A=t.minFadingSpeed,T=t.maxSpeedX,x=t.maxSpeedY,void 0!==t.maxScaleSpeed&&setMaxScaleSpeed(t.maxScaleSpeed),void 0!==t.maxScaleSpeedX&&(maxScaleSpeedX=t.maxScaleSpeedX),void 0!==t.maxScaleSpeedY&&(maxScaleSpeedY=t.maxScaleSpeedY),P=t.maxRotationSpeed,H=t.maxFadingSpeed,V=t.toX,N=t.toY,void 0!==t.toScale&&De(t.toScale),void 0!==t.toScaleX&&(L=t.toScaleX),void 0!==t.toScaleY&&(W=t.toScaleY),F=t.toAngle,U=t.toAlpha,void 0!==t.isHiding&&(le=t.isHiding)),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===c&&(c=0),void 0===f&&(f=0),void 0===S&&(S=0),void 0===v&&(v=0),void 0===p&&(p=0),void 0===l&&(l=1),void 0===g&&(g=1),void 0===s&&(s=0),void 0===R&&(R=0),void 0===y&&(y=0),void 0===k&&(k=0),void 0===d&&(d=0),void 0===h&&(h=0),void 0===C&&(C=0),void 0===u&&(u=1),void 0===E&&(E=0),void 0===X&&(X=0),SkyEngine.Screen!==n&&SkyEngine.Screen.registerNode(n);let Ie=(n.setFilter=(e=>{ne=e}),n.getFilter=(()=>{return ne}),n.removeFilter=(()=>{ne=void 0}),n.setBlendMode=(e=>{te=e}),n.getBlendMode=(()=>{return te}),n.removeBlendMode=(()=>{te=void 0}),n.moveLeft=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(f=-e.speed),void 0!==e.accel&&(v=-e.accel),void 0!==e.maxSpeed&&(D=-e.maxSpeed)):(v=0,f=D=-e)}),n.stopLeft=(e=>{void 0!==e?(v=e,T=0):f<0&&(f=0)}),n.moveRight=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(f=e.speed),void 0!==e.accel&&(v=e.accel),void 0!==e.maxSpeed&&(T=e.maxSpeed)):(v=0,f=T=e)})),me=(n.stopRight=(e=>{void 0!==e?(v=-e,D=0):f>0&&(f=0)}),n.moveUp=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(S=-e.speed),void 0!==e.accel&&(p=-e.accel),void 0!==e.maxSpeed&&(Y=-e.maxSpeed)):(p=0,S=Y=-e)}),n.stopUp=(e=>{void 0!==e?(p=e,x=0):S<0&&(S=0)}),n.moveDown=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(S=e.speed),void 0!==e.accel&&(p=e.accel),void 0!==e.maxSpeed&&(x=e.maxSpeed)):(p=0,S=x=e)})),Ae=(n.stopDown=(e=>{void 0!==e?(p=-e,Y=0):S>0&&(S=0)}),n.moveTo=(e=>{if(void 0===e.toY)V=e.toX,Ie(e);else if(void 0===e.toX)N=e.toY,me(e);else{V=e.toX,N=e.toY;let n=Math.sqrt(V*V+N*N);void 0!==e.speed&&(f=e.speed*V/n,S=e.speed*N/n),void 0!==e.accel&&(v=e.accel*V/n,p=e.accel*N/n),void 0!==e.maxSpeed&&(T=e.maxSpeed*V/n,x=e.maxSpeed*N/n)}}),n.stuckLeft=(()=>{ie=!0}),n.unstuckLeft=(()=>{ie=!1}),n.stuckRight=(()=>{oe=!0}),n.unstuckRight=(()=>{oe=!1}),n.stuckUp=(()=>{ce=!0}),n.unstuckUp=(()=>{ce=!1}),n.stuckDown=(()=>{ae=!0}),n.unstuckDown=(()=>{ae=!1}),n.rotate=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(h=e.speed),void 0!==e.accel&&(C=e.accel),void 0!==e.minSpeed&&(m=e.minSpeed),void 0!==e.maxSpeed&&(P=e.maxSpeed)):h=e}),n.stopRotation=(e=>{void 0!==e?(C=-e,e>0?m=0:e<0&&(P=0)):h>0&&(h=0)}),n.rotateTo=(e=>{F=e.toAngle,void 0!==e.speed&&(h=e.speed),void 0!==e.accel&&(C=e.accel),void 0!==e.minSpeed&&(m=e.minSpeed),void 0!==e.maxSpeed&&(P=e.maxSpeed)}),n.flipX=(()=>{l=-l}),n.flipY=(()=>{g=-g}),n.fadeIn=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(E=e.speed),void 0!==e.accel&&(X=e.accel),void 0!==e.maxSpeed&&(H=e.maxSpeed)):E=e}),n.fadeOut=(e=>{CHECK_IS_DATA(e)===!0?(void 0!==e.speed&&(E=-e.speed),void 0!==e.accel&&(X=-e.accel),void 0!==e.maxSpeed&&(A=-e.maxSpeed)):E=-e}),n.stopFading=(e=>{void 0!==e?(X=-e,e>0?A=0:e<0&&(H=0)):E>0&&(E=0)}),n.fadeTo=(e=>{U=e.toAlpha,void 0!==e.speed&&(E=e.speed),void 0!==e.accel&&(X=e.accel),void 0!==e.minSpeed&&(A=e.minSpeed),void 0!==e.maxSpeed&&(H=e.maxSpeed)}),n.hide=(()=>{le=!0}),n.show=(()=>{le=!1}),n.checkIsHiding=(()=>{return le}),n.getChildren=(()=>{return re}),n.getParent=(()=>{return $}),n.setTarget=(e=>{ee=e,void 0!==ee&&(we(),n.getTouchAreas().forEach(e=>{e.setTarget(n)}),n.getColliders().forEach(e=>{e.setTarget(n)}),n.getChildren().forEach(e=>{e.setTarget(n)}))})),Te=n.setParent=(e=>{$=e,Ae($)}),xe=()=>{let e=$.getChildren(),t=0,i=e.length;for(;t<i;){let n=t+i>>>1;e[n].getZ()<=c?t=n+1:i=n}e.splice(t,0,n)},Me=()=>{let e=$.getChildren(),t=0,i=e.length-1,o=0;for(;t<=i;){let a=Math.ceil((t+i)/2),r=e[a];if(r.getZ()<c)t=a+1;else{if(!(r.getZ()>c)){for(;;){if(e[a-o]===n){e.splice(a-o,1);break}if(o>0&&e[a+o]===n){e.splice(a+o,1);break}if(e[a-o].getZ()!==c&&e[a+o].getZ()!==c)break;o+=1}break}i=a-1}}},Oe=(n.appendTo=(e=>{return void 0!==$&&Me(),Te(e),xe(),n}),n.append=(e=>{e.appendTo(n)}),n.remove=(()=>{re.forEach(e=>{e.setParent(void 0),e.remove()}),re=void 0,void 0!==$&&(Me(),Te(void 0)),SkyEngine.Screen!==n&&SkyEngine.Screen.unregisterNode(n),EACH(de,(e,t)=>{SkyEngine.Screen.unregisterEventNode(t,n)}),de=void 0,fe.forEach(e=>{e.remove()}),fe=void 0,ue.forEach(e=>{e.remove()}),ue=void 0,Se=void 0,se=void 0,Re=void 0,he=void 0,ge=!0}),n.checkIsRemoved=(()=>{return ge}),n.on=((e,t)=>{void 0===de[e]&&(de[e]=[],SkyEngine.Screen.registerEventNode(e,n)),de[e].push(t)}),n.off=((e,t)=>{ge!==!0&&void 0!==de[e]&&(void 0!==t&&REMOVE({array:de[e],value:t}),void 0!==t&&0!==de[e].length||(delete de[e],SkyEngine.Screen.unregisterEventNode(e,n)))})),Pe=n.fireEvent=(e=>{void 0!==de[e]&&de[e].forEach(e=>{e(n)})}),He=(n.onMeet=((e,n)=>{Se.push(e),void 0===Re[e.id]&&(Re[e.id]=[]),Re[e.id].push(n),Ne()}),n.offMeet=((e,n)=>{void 0===n?delete Re[e.id]:REMOVE({array:Re[e.id],value:n})}),n.runMeetHandlers=((e,n)=>{void 0!==Re[e.id]&&Re[e.id].forEach(e=>{e(n)})})),Ve=(n.onPart=((e,n)=>{Se.push(e),void 0===he[e.id]&&(he[e.id]=[]),he[e.id].push(n)}),n.offPart=((e,n)=>{void 0===n?delete he[e.id]:REMOVE({array:he[e.id],value:n})}),n.runPartHandlers=((e,n)=>{void 0!==he[e.id]&&he[e.id].forEach(e=>{e(n)})})),Ne=(n.addTouchArea=(e=>{fe.push(e),e.setTarget(n)}),n.getTouchAreas=(()=>{return fe}),n.getTouchArea=(()=>{return fe[0]}),n.addCollider=(e=>{ue.push(e),e.setTarget(n)}),n.getColliders=(()=>{return ue}),n.getCollider=(()=>{return ue[0]}),n.checkPoint=((e,n)=>{return re.every(t=>{return t.checkPoint(e,n)!==!0})!==!0}),n.checkArea=(e=>{return re.every(n=>{return n.checkArea(e)!==!0&&e.checkArea(n)!==!0})!==!0}),n.checkTouch=((e,t)=>{return n.checkIsHiding()!==!0&&(fe.every(n=>{return n.checkPoint(e,t)!==!0})!==!0||re.every(n=>{return n.checkTouch(e,t)!==!0})!==!0)}),n.checkCollision=(e=>{return ge!==!0&&n.checkIsHiding()!==!0&&(e.type===CLASS?SkyEngine.Screen.getRegisteredNodes(e).every(e=>{if(e!==n)return n.checkCollision(e)!==!0})!==!0:e.checkIsHiding()!==!0&&(ue.every(n=>{return e.checkIsRemoved()!==!0&&e.getColliders().every(e=>{return n.checkArea(e)!==!0})})!==!0||re.every(n=>{return n.checkCollision(e)!==!0})!==!0))}),n.checkOffScreen=(()=>{return re.every(e=>{return e.checkOffScreen(target)===!0})===!0}),()=>{Se.forEach((e,t,i)=>{e.type===CLASS?SkyEngine.Screen.getRegisteredNodes(e).forEach(t=>{t!==n&&(t.checkIsRemoved()!==!0?n.checkCollision(t)===!0||n.type!==t.type&&t.checkCollision(n)===!0?ge!==!0&&void 0===se[t.id]&&(se[t.id]=!0,He(e,t)):ge!==!0&&void 0!==se[t.id]&&(delete se[t.id],Ve(e,t)):delete se[t.id])}):e.checkIsRemoved()!==!0?n.checkCollision(e)===!0||n.type!==e.type&&e.checkCollision(n)===!0?void 0===se[e.id]&&(se[e.id]=!0,He(e,e)):void 0!==se[e.id]&&(delete se[e.id],Ve(e,e)):(i.splice(t,1),delete se[e.id],delete Re[e.id],delete he[e.id])})});n.step=(e=>{if(j=i,Q=o,0!==v&&(f+=v*e/1e3),void 0!==D&&f<D&&(f=D),void 0!==T&&f>T&&(f=T),0!==p&&(S+=p*e/1e3),void 0!==Y&&S<Y&&(S=Y),void 0!==x&&S>x&&(S=x),0!==f){let n=f*e/1e3;(n<0&&ie!==!0||n>0&&oe!==!0)&&(i+=n,void 0!==V&&(f>0&&i>V||f<0&&i<V)&&(i=V,f=0))}if(0!==S){let n=S*e/1e3;(n<0&&ce!==!0||n>0&&ae!==!0)&&(o+=n,void 0!==N&&(S>0&&o>N||S<0&&o<N)&&(o=N,S=0))}0!==y&&(s+=y*e/1e3),void 0!==w&&s<w&&(s=w),void 0!==M&&s>M&&(s=M),0!==k&&(R+=k*e/1e3),void 0!==I&&R<I&&(R=I),void 0!==O&&R>O&&(R=O),0!==s&&(l+=s*e/1e3,void 0!==L&&(s>0&&l>L||s<0&&l<L)&&(l=L,s=0)),0!==R&&(g+=R*e/1e3,void 0!==W&&(R>0&&g>W||R<0&&g<W)&&(g=W,R=0)),0!==C&&(h+=C*e/1e3),void 0!==m&&h<m&&(h=m),void 0!==P&&h>P&&(h=P),0!==h&&(d+=h*e/1e3,void 0!==F&&(h>0&&d>=F||h<0&&d<=F)&&(d=F,h=0),d>=360?d=0:d<=0&&(d=360)),0!==X&&(E+=X*e/1e3),void 0!==A&&E<A&&(E=A),void 0!==H&&E>H&&(E=H),0!==E&&(u+=E*e/1e3,void 0!==U&&(E>0&&u>U||E<0&&u<U)&&(u=U,E=0),u>1?u=1:u<0&&(u=0)),we(),n.getTouchAreas().forEach(n=>{n.step(e)}),n.getColliders().forEach(n=>{n.step(e)}),Ne(),void 0!==re&&re.forEach(n=>{n.step(e)}),void 0!==de&&void 0!==de.offscreen&&n.checkOffScreen()===!0&&Pe("offscreen"),void 0!==de&&void 0!==de.nextstep&&(Pe("nextstep"),Oe("nextstep")),void 0===de||void 0===de.move||i===j&&o===Q||Pe("move")}),n.draw=(e=>{}),n.drawArea=(e=>{}),n.clone=(e=>{let t,b={x:i,y:o,centerX:a,centerY:r,z:c,speedX:f,speedY:S,accelX:v,accelY:p,minSpeedX:D,minSpeedY:Y,maxSpeedX:T,maxSpeedY:x,toX:V,toY:N,scaleX:l,scaleY:g,scalingSpeedX:s,scalingSpeedY:R,scalingAccelX:y,scalingAccelY:k,minScalingSpeedX:w,minScalingSpeedY:I,maxScalingSpeedX:M,maxScalingSpeedY:O,toScaleX:L,toScaleY:W,angle:d,rotationSpeed:h,rotationAccel:C,minRotationSpeed:m,maxRotationSpeed:P,toAngle:F,alpha:u,fadingSpeed:E,fadingAccel:X,minFadingSpeed:A,maxFadingSpeed:H,toAlpha:U};void 0!==e&&(void 0!==e.exceptChildNodes&&(t=e.exceptChildNodes,delete e.exceptChildNodes),EXTEND({origin:b,extend:e}));let _=n.type(b);return EACH(ue,e=>{_.addCollider(e.clone())}),EACH(fe,e=>{_.addTouchArea(e.clone())}),EACH(re,e=>{void 0!==t&&CHECK_IS_IN({array:t,value:e})===!0||_.append(e.clone())}),EACH(de,(e,n)=>{EACH(e,e=>{_.on(n,e)})}),EACH(Se,e=>{void 0!==Re[target.id]&&EACH(Re[target.id],n=>{_.onMeet(e,n)}),void 0!==he[target.id]&&EACH(he[target.id],n=>{_.onPart(e,n)})}),void 0!==ne&&_.setFilter(ne),void 0!==te&&_.setBlendMode(te),le===!0&&_.hide(),_});we()},afterInit:(e,n,t)=>{void 0!==t&&(void 0!==t.c&&(CHECK_IS_ARRAY(t.c)===!0?EACH(t.c,e=>{n.append(e)}):n.append(t.c)),void 0!==t.on&&EACH(t.on,(e,t)=>{n.on(t,e)}),void 0!==t.touchArea&&(CHECK_IS_ARRAY(t.touchArea)===!0?EACH(t.touchArea,e=>{n.addTouchArea(e)}):n.addTouchArea(t.touchArea)),void 0!==t.collider&&(CHECK_IS_ARRAY(t.collider)===!0?EACH(t.collider,e=>{n.addCollider(e)}):n.addCollider(t.collider)))}}),SkyEngine.Dom=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i;void 0!==t&&(i=t.style);let o=DIV({style:{position:"fixed"}}).appendTo(BODY);void 0!==i&&o.addStyle(i);let c;n.getDom=(()=>{return o});OVERRIDE(n.append,e=>{c=n.append=(e=>{o.append(e)})});let a;OVERRIDE(n.on,e=>{a=n.on=((e,n)=>{o.on(e,n)})});let r;OVERRIDE(n.draw,e=>{r=n.draw=(t=>{o.addStyle({left:SkyEngine.Screen.getWidth()/2+n.getDrawingX()-o.getWidth()/2,top:SkyEngine.Screen.getHeight()/2+n.getDrawingY()-o.getHeight()/2,transform:"rotate("+n.getRealRadian()+"rad) scale("+n.getRealScaleX()+", "+n.getRealScaleY()+")",opacity:t.globalAlpha,filter:t.filter}),e(t)})});let l;OVERRIDE(n.remove,e=>{l=n.remove=(()=>{o.remove(),e()})});let g;OVERRIDE(n.clone,e=>{g=n.clone=(n=>{let t={style:i};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})})}}),SkyEngine.Figure=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c,a=t.color,r=t.border;if(void 0!==r){let e=r.split(" ");i=INTEGER(e[0]),o=e[1],c=e[2]}let l;OVERRIDE(n.draw,e=>{l=n.draw=(n=>{void 0!==a&&(n.fillStyle=a,n.fill()),void 0!==r&&(n.lineWidth=i,n.strokeStyle=c,"dashed"===o?n.setLineDash([5]):"dotted"===o&&n.setLineDash([2]),n.stroke()),n.closePath(),e(n)})});let g;OVERRIDE(n.drawArea,e=>{g=n.drawArea=(n=>{e(n)})});let d;OVERRIDE(n.clone,e=>{d=n.clone=(n=>{let t={color:a,border:r};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})})}}),SkyEngine.Particle=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{}}),SkyEngine.Screen=OBJECT({preset:()=>{return SkyEngine.Node},init:(e,n)=>{let t,i,o,c,a,r=DIV({style:{position:"fixed",left:0,top:0}}).appendTo(BODY),l=CANVAS().appendTo(r),g=l.getContext("2d"),d={},u={};n.registerNode=(e=>{let n=e.type;for(;void 0!==n&&n!==CLASS;)void 0===d[n.id]&&(d[n.id]=[]),d[n.id].push(e),n=n.mom}),n.unregisterNode=(e=>{let n=e.type;for(;void 0!==n&&n!==CLASS;)void 0!==d[n.id]&&(REMOVE({array:d[n.id],value:e}),0===d[n.id].length&&delete d[n.id]),n=n.mom}),n.getRegisteredNodes=(e=>{return void 0===d[e.id]?[]:d[e.id]}),n.registerEventNode=((e,n)=>{void 0!==u[e]&&u[e].push(n)}),n.unregisterEventNode=((e,n)=>{void 0!==u[e]&&REMOVE({array:u[e],value:n})});if(CONFIG.SkyEngine.isDebugMode===!0){let e=DIV({style:{position:"fixed",left:5,top:5,fontSize:12}}).appendTo(BODY);INTERVAL(.1,()=>{void 0!==o&&(e.empty(),e.append("FPS: "+parseInt(1/o*1e3)))})}EACH(["tap","touchstart","touchend"],e=>{u[e]=[],l.on(e,n=>{EACH(u[e],o=>{o.checkTouch(n.getLeft()-t/2,n.getTop()-i/2)===!0&&o.fireEvent(e)}),n.stop()})});let f=(e,n,t)=>{n.save(),n.translate(e.getDrawingX(),e.getDrawingY()),n.rotate(e.getRealRadian()),n.scale(e.getRealScaleX(),e.getRealScaleY()),n.lineWidth=1/(e.getRealScaleX()>e.getRealScaleY()?e.getRealScaleX():e.getRealScaleY()),n.beginPath(),e.drawArea(n),n.strokeStyle=t,n.stroke(),n.closePath(),n.restore(),e.getChildren().forEach(e=>{f(e,n,t)})},S=(e,n,t)=>{if(e.checkIsHiding()!==!0&&(t*=e.getAlpha(),n.save(),void 0!==e.getFilter()&&(n.filter=e.getFilter()),void 0!==e.getBlendMode()&&(n.globalCompositeOperation=e.getBlendMode()),n.save(),n.translate(e.getDrawingX(),e.getDrawingY()),n.rotate(e.getRealRadian()),n.scale(e.getRealScaleX(),e.getRealScaleY()),n.globalAlpha=t,e.draw(n),n.restore(),e.getChildren().forEach(e=>{S(e,n,t)}),n.restore(),CONFIG.SkyEngine.isDebugMode===!0)){n.beginPath(),n.strokeStyle=n.fillStyle="aqua";let t=e.getRealX(),i=e.getRealY();n.rect(t-1,i-1,2,2),n.moveTo(t-15,i),n.lineTo(t+15,i),n.moveTo(t,i-15),n.lineTo(t,i+15),n.stroke(),e.getTouchAreas().forEach(e=>{f(e,n,"magenta")}),e.getColliders().forEach(e=>{f(e,n,"lime")})}},s=LOOP(e=>{o=e,n.step(o),g.clearRect(0,0,t,i),g.save(),g.translate(t/2-p(),i/2-y()),S(n,g,n.getAlpha()),g.restore()});EVENT("resize",RAR(()=>{t=WIN_WIDTH(),i=WIN_HEIGHT(),l.setSize({width:t,height:i})})),n.on("remove",()=>{s.remove()});let R=n.followX=(e=>{c=e}),h=n.followY=(e=>{a=e}),E=(n.follow=(e=>{R(e),h(e)}),n.unfollowX=(e=>{c=void 0})),v=n.unfollowY=(e=>{a=void 0}),p=(n.unfollow=(e=>{E(),v()}),n.getFollowX=(()=>{return void 0===c?0:c.checkIsRemoved()===!0?(c=void 0,0):c.getRealX()})),y=n.getFollowY=(()=>{return void 0===a?0:a.checkIsRemoved()===!0?(a=void 0,0):a.getRealY()});n.getWidth=(()=>{return t}),n.getHeight=(()=>{return i}),n.getCanvasContext=(()=>{return g})}}),SkyEngine.StateSet=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c,a={},r=n.setStateNode=(e=>{let t=e.state,i=e.node;void 0!==a[name]&&a[name].remove(),i.hide(),n.append(i),a[t]=i});EACH(t.stateNodes,(e,n)=>{r({state:n,node:e})});let l=n.setState=(e=>{void 0!==c&&(a[i].off("animationend",c),c=void 0),i!==e&&(i=e,EACH(a,e=>{e.hide()}),a[i].show())});l(t.baseState);let g;n.setToState=(e=>{i!==e&&(o=e,a[i].on("animationend",c=(()=>{l(o)})))}),n.getState=(()=>{return i});OVERRIDE(n.clone,e=>{g=n.clone=(n=>{let t=[];EACH(a,e=>{t.push(e)});let o={exceptChildNodes:t,baseState:i};void 0!==n&&EXTEND({origin:o,extend:n});let c=e(o);return EACH(a,(e,n)=>{r({state:n,node:e.clone()})}),c})})}}),SkyEngine.Circle=CLASS(e=>{e.findRaycastPoints=((e,n,t,i,o,c,a,r,l,g)=>{let d=g*e+l*n-t,u=-l*e+g*n-i;o*=a,c*=r;let f=o/2,S=c/2,s=99999,R=(1-d*s/f/f*S*S)/u+i;s+=t;let h=-99999,E=(1-d*h/f/f*S*S)/u+i;return h+=t,SkyEngine.Line.findCircleIntersectionPoints(0,0,s,R,h,E,1,1,0,1,t,i,o,c,1,1,l,g)});return{preset:()=>{return SkyEngine.Figure},init:(n,t,i)=>{let o=i.width,c=i.height,a=SkyEngine.Util.Collision.checkPointInCircle,r=SkyEngine.Util.Collision.checkLineCircle,l=SkyEngine.Util.Collision.checkRectCircle,g=SkyEngine.Util.Collision.checkCircleCircle;t.setWidth=(e=>{o=e}),t.getWidth=(()=>{return o}),t.setHeight=(e=>{c=e}),t.getHeight=(()=>{return c});OVERRIDE(t.checkPoint,e=>{t.checkPoint=((n,i)=>{return a(n,i,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0||e(n,i)===!0})});let d;OVERRIDE(t.checkArea,e=>{d=t.checkArea=(n=>{if(n.type===SkyEngine.Line){if(r(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect){if(l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Circle&&g(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0;return e(n)})});let u;OVERRIDE(t.checkOffScreen,e=>{u=t.checkOffScreen=(n=>{return l(0,0,SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0&&e(n)})});let f;OVERRIDE(t.draw,e=>{f=t.draw=(n=>{n.beginPath(),n.ellipse(0,0,o/2,c/2,0,0,2*Math.PI),e(n)})});let S;OVERRIDE(t.drawArea,e=>{S=t.drawArea=(n=>{n.ellipse(0,0,o/2,c/2,0,0,2*Math.PI),e(n)})});let s;OVERRIDE(t.clone,e=>{s=t.clone=(n=>{let t={width:o,height:c};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})});t.findRaycastPoints=((n,i)=>{return e.findRaycastPoints(n,i,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())})}}}),SkyEngine.Line=CLASS(e=>{let n=e.findLineIntersectionPoint=((e,n,t,i,o,c,a,r,l,g,d,u,f,S,s,R,h,E,v,p)=>{if(SkyEngine.Util.Collision.checkLineLine(e,n,t,i,o,c,a,r,l,g,d,u,f,S,s,R,h,E,v,p)===!0){t*=a,i*=r;let y=e+g*t+l*i,k=n+l*t+g*i;o*=a,c*=r;let C=e+g*o+l*c,X=n+l*o+g*c;f*=h,S*=E;let D=d+p*f+v*S,Y=u+v*f+p*S;s*=h,R*=E;let w=d+p*s+v*R,I=u+v*s+p*R,m=(C-y)*(I-Y)-(w-D)*(X-k);return{x:((C*k-X*y)*(w-D)-(C-y)*(w*Y-I*D))/m,y:((C*k-X*y)*(I-Y)-(X-k)*(w*Y-I*D))/m}}}),t=e.findRectIntersectionPoints=((e,t,i,o,c,a,r,l,g,d,u,f,S,s,R,h,E,v)=>{let p=[];i*=r,o*=l;let y=e+d*i+g*o,k=t+g*i+d*o;c*=r,a*=l;let C,X,D,Y,w,I,m,A,T=e+d*c+g*a,x=t+g*c+d*a;S*=R/2,s*=h/2;let M=v*S,O=v*s,P=-E*S,H=-E*s;C=u-M-H,X=f+P-O,D=u+M-H,Y=f-P-O,w=u+M+H,I=f-P+O,m=u-M+H,A=f+P+O;let V=n(0,0,y,k,T,x,1,1,0,1,0,0,C,X,D,Y,1,1,0,1);return void 0!==V&&p.push(V),V=n(0,0,y,k,T,x,1,1,0,1,0,0,D,Y,w,I,1,1,0,1),void 0!==V&&p.push(V),V=n(0,0,y,k,T,x,1,1,0,1,0,0,w,I,m,A,1,1,0,1),void 0!==V&&p.push(V),V=n(0,0,y,k,T,x,1,1,0,1,0,0,m,A,C,X,1,1,0,1),void 0!==V&&p.push(V),p}),i=e.findCircleIntersectionPoints=((e,n,t,i,o,c,a,r,l,g,d,u,f,S,s,R,h,E)=>{let v=[];if(SkyEngine.Util.Collision.checkLineCircle(e,n,t,i,o,c,a,r,l,g,d,u,f,S,s,R,h,E)===!0){t*=a,i*=r;let p=e+g*t+l*i-d,y=n+l*t+g*i-u;o*=a,c*=r;let k=e+g*o+l*c-d,C=n+l*o+g*c-u,X=E*p+h*y,D=-h*p+E*y,Y=E*k+h*C,w=-h*k+E*C;f*=s,S*=R;let I=f/2,m=S/2,A=(w-D)/(Y-X),T=D-A*X,x=A*A*I*I+m*m,M=2*A*T*I*I,O=I*I*T*T-I*I*m*m,P=M*M-4*x*O;if(P>0){let e=(-M+Math.sqrt(P))/(2*x),n=A*e+T,t=(-M-Math.sqrt(P))/(2*x),i=A*t+T;(X<Y?X:Y)<=e&&e<=(X<Y?Y:X)&&(D<w?D:w)<=n&&n<=(D<w?w:D)&&v.push({x:E*e-h*n+d,y:h*e+E*n+u}),(X<Y?X:Y)<=t&&t<=(X<Y?Y:X)&&(D<w?D:w)<=i&&i<=(D<w?w:D)&&v.push({x:E*t-h*i+d,y:h*t+E*i+u})}else if(0==P){let e=-M/(2*x),n=A*e+T;(X<Y?X:Y)<=e&&e<=(X<Y?Y:X)&&(D<w?D:w)<=n&&n<=(D<w?w:D)&&v.push({x:E*e-h*n+d,y:h*e+E*n+u})}}return v}),o=e.findPolygonIntersectionPoints=((e,t,i,o,c,a,r,l,g,d,u,f,S,s,R,h,E)=>{let v=[];i*=r,o*=l;let p=e+d*i+g*o,y=t+g*i+d*o;c*=r,a*=l;let k=e+d*c+g*a,C=t+g*c+d*a,X=S.length;for(let D=0,Y=X-1;D<X;Y=D,D+=1){let e=S[D].x*s,t=S[D].y*R,i=S[Y].x*s,o=S[Y].y*R,c=u+E*e-h*t,a=f+h*e+E*t,r=u+E*i-h*o,l=f+h*i+E*o,g=n(0,0,p,y,k,C,1,1,0,1,0,0,c,a,r,l,1,1,0,1);void 0!==g&&v.push(g)}return v});e.findRaycastPoints=((e,n,t,i,o,c,a,r,l,g,d,u)=>{});return{preset:()=>{return SkyEngine.Figure},init:(e,c,a)=>{let r=a.startX,l=a.startY,g=a.endX,d=a.endY,u=a.isEndless,f=SkyEngine.Util.Collision.checkLineLine,S=SkyEngine.Util.Collision.checkLineRect;u===!0&&(Math.abs(g-r)<Math.abs(d-l)?(g=((d-l<0?-999999:999999)-l)/(d-l)*(g-r)+r,d=d-l<0?-999999:999999):(d=(d-l)/(g-r)*((g-r<0?-999999:999999)-r)+l,g=g-r<0?-999999:999999));let s;c.setStartX=(e=>{r=e}),c.getStartX=(()=>{return r}),c.setStartY=(e=>{l=e}),c.getStartY=(()=>{return l}),c.setEndX=(e=>{g=e}),c.getEndX=(()=>{return g}),c.setEndY=(e=>{d=e}),c.getEndY=(()=>{return d});OVERRIDE(c.checkArea,e=>{s=c.checkArea=(n=>{return n.type===SkyEngine.Line&&f(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos())===!0||e(n)})});let R;OVERRIDE(c.checkOffScreen,e=>{R=c.checkOffScreen=(n=>{return S(c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),0,0,SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1)===!0||e(n)})});let h;OVERRIDE(c.draw,e=>{h=c.draw=(n=>{n.beginPath(),n.moveTo(r,l),n.lineTo(g,d),e(n)})});let E;OVERRIDE(c.drawArea,e=>{E=c.drawArea=(n=>{n.moveTo(r,l),n.lineTo(g,d),e(n)})});let v;c.findIntersectionPoints=(e=>{let a=[];if(e.checkIsInstanceOf(SkyEngine.Line)===!0){let t=n(c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getStartX(),e.getStartY(),e.getEndX(),e.getEndY(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos());void 0!==t&&a.push(t)}else e.checkIsInstanceOf(SkyEngine.Rect)===!0?a=t(c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getWidth(),e.getHeight(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()):e.checkIsInstanceOf(SkyEngine.Circle)===!0?a=i(c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getWidth(),e.getHeight(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()):e.checkIsInstanceOf(SkyEngine.Polygon)===!0&&(a=o(c.getDrawingX(),c.getDrawingY(),r,l,g,d,c.getRealScaleX(),c.getRealScaleY(),c.getRealSin(),c.getRealCos(),e.getDrawingX(),e.getDrawingY(),e.getPoints(),e.getRealScaleX(),e.getRealScaleY(),e.getRealSin(),e.getRealCos()));return a});OVERRIDE(c.clone,e=>{v=c.clone=(n=>{let t={startX:r,startY:l,endX:g,endY:d};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})})}}}),SkyEngine.Polygon=CLASS(e=>{e.findRaycastPoints=((e,n,t,i,o,c,a,r,l)=>{let g,d,u,f,S,s,R=o.length;for(let h=0;h<R;h+=1){let R=o[h].x*c,E=o[h].y*a,v=t+l*R-r*E,p=i+r*R+l*E,y=v-e,k=p-n,C=Math.acos(y/Math.sqrt(y*y+k*k));k>0&&(C=Math.PI+Math.PI-C),(void 0==g||g>C)&&(g=C,d=v,u=p),(void 0==f||f<C)&&(f=C,S=v,s=p)}return void 0===g?[]:[{x:d,y:u},{x:S,y:s}]});return{preset:()=>{return SkyEngine.Figure},init:(n,t,i)=>{let o=i.points,c=SkyEngine.Util.Collision.checkPointInPolygon,a=SkyEngine.Util.Collision.checkLinePolygon,r=SkyEngine.Util.Collision.checkRectPolygon,l=SkyEngine.Util.Collision.checkCirclePolygon,g=SkyEngine.Util.Collision.checkPolygonPolygon;t.getPoints=(()=>{return o}),t.setColor=(e=>{e=_color}),t.getColor=(()=>{return color});OVERRIDE(t.checkPoint,e=>{t.checkPoint=((n,i)=>{return c(n,i,t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0||e(n,i)===!0})});let d;OVERRIDE(t.checkArea,e=>{d=t.checkArea=(n=>{if(n.type===SkyEngine.Line){if(a(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect){if(r(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Circle){if(l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Polygon&&g(n.getDrawingX(),n.getDrawingY(),n.getPoints(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0;return e(n)})});let u;OVERRIDE(t.checkOffScreen,e=>{u=t.checkOffScreen=(n=>{return r(0,0,SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())!==!0||e(n)})});let f;OVERRIDE(t.draw,e=>{f=t.draw=(n=>{if(n.beginPath(),o.length>0){n.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e+=1){let t=o[e];n.lineTo(t.x,t.y)}n.lineTo(o[0].x,o[0].y)}e(n)})});let S;OVERRIDE(t.drawArea,e=>{S=t.drawArea=(n=>{if(o.length>0){n.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e+=1){let t=o[e];n.lineTo(t.x,t.y)}n.lineTo(o[0].x,o[0].y)}e(n)})});let s;OVERRIDE(t.clone,e=>{s=t.clone=(n=>{let t={points:o};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})});t.findRaycastPoints=((n,i)=>{return e.findRaycastPoints(n,i,t.getDrawingX(),t.getDrawingY(),o,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())})}}}),SkyEngine.Rect=CLASS(e=>{e.findRaycastPoints=((e,n,t,i,o,c,a,r,l,g)=>{let d,u,f,S,s,R,h,E;o*=a,c*=r;let v=g*o/2,p=g*c/2,y=-l*o/2,k=-l*c/2;d=t-v-k,u=i+y-p,f=t+v-k,S=i-y-p,s=t+v+k,R=i-y+p,h=t-v+k,E=i+y+p;let C=d-e,X=u-n,D=Math.acos(C/Math.sqrt(C*C+X*X));X>0&&(D=Math.PI+Math.PI-D);let Y=D,w=d,I=u,m=D,A=d,T=u;return C=f-e,X=S-n,D=Math.acos(C/Math.sqrt(C*C+X*X)),X>0&&(D=Math.PI+Math.PI-D),Y>D&&(Y=D,w=f,I=S),m<D&&(m=D,A=f,T=S),C=s-e,X=R-n,D=Math.acos(C/Math.sqrt(C*C+X*X)),X>0&&(D=Math.PI+Math.PI-D),Y>D&&(Y=D,w=s,I=R),m<D&&(m=D,A=s,T=R),C=h-e,X=E-n,D=Math.acos(C/Math.sqrt(C*C+X*X)),X>0&&(D=Math.PI+Math.PI-D),Y>D&&(Y=D,w=h,I=E),m<D&&(m=D,A=h,T=E),[{x:w,y:I},{x:A,y:T}]});return{preset:()=>{return SkyEngine.Figure},init:(n,t,i)=>{let o=i.width,c=i.height,a=SkyEngine.Util.Collision.checkPointInRect,r=SkyEngine.Util.Collision.checkLineRect,l=SkyEngine.Util.Collision.checkRectRect;t.setWidth=(e=>{o=e}),t.getWidth=(()=>{return o}),t.setHeight=(e=>{c=e}),t.getHeight=(()=>{return c}),t.setColor=(e=>{e=_color}),t.getColor=(()=>{return color});OVERRIDE(t.checkPoint,e=>{t.checkPoint=((n,i)=>{return a(n,i,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0||e(n,i)===!0})});let g;OVERRIDE(t.checkArea,e=>{g=t.checkArea=(n=>{if(n.type===SkyEngine.Line){if(r(n.getDrawingX(),n.getDrawingY(),n.getStartX(),n.getStartY(),n.getEndX(),n.getEndY(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0}else if(n.type===SkyEngine.Rect&&l(n.getDrawingX(),n.getDrawingY(),n.getWidth(),n.getHeight(),n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos(),t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0)return!0;return e(n)})});let d;OVERRIDE(t.checkOffScreen,e=>{d=t.checkOffScreen=(n=>{return l(0,0,SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())===!0||e(n)})});let u;OVERRIDE(t.draw,e=>{u=t.draw=(n=>{n.beginPath(),n.rect(-o/2,-c/2,o,c),e(n)})});let f;OVERRIDE(t.drawArea,e=>{f=t.drawArea=(n=>{n.rect(-o/2,-c/2,o,c),e(n)})});let S;OVERRIDE(t.clone,e=>{
S=t.clone=(n=>{let t={width:o,height:c};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})});t.findRaycastPoints=((n,i)=>{return e.findRaycastPoints(n,i,t.getDrawingX(),t.getDrawingY(),o,c,t.getRealScaleX(),t.getRealScaleY(),t.getRealSin(),t.getRealCos())})}}}),SkyEngine.Background=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c=t.src,a=t.isNotToRepeatX,r=t.isNotToRepeatY,l=new Image;l.onload=(()=>{i=l.width,o=l.height,l.onload=void 0,n.fireEvent("load")}),l.src=c;let g;OVERRIDE(n.draw,e=>{g=n.draw=(t=>{if(void 0!==i)if(a===!0&&r===!0)t.drawImage(l,-i/2,-o/2,i,o);else if(a===!0){let e=-o/2,c=SkyEngine.Screen.getFollowY()/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY(),a=SkyEngine.Screen.getHeight()/2/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY();for(;c-a<e;)e-=o;for(;e<c+a;)t.drawImage(l,-i/2,e,i,o),e+=o}else if(r===!0){let e=-i/2,c=SkyEngine.Screen.getFollowX()/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),a=SkyEngine.Screen.getWidth()/2/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX();for(;c-a<e;)e-=i;for(;e<c+a;)t.drawImage(l,e,-o/2,i,o),e+=i}else{let e=-i/2,c=-o/2,a=SkyEngine.Screen.getFollowX()/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),r=SkyEngine.Screen.getFollowY()/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY(),g=SkyEngine.Screen.getWidth()/2/SkyEngine.Screen.getRealScaleX()/n.getRealScaleX(),d=SkyEngine.Screen.getHeight()/2/SkyEngine.Screen.getRealScaleY()/n.getRealScaleY();for(;a-g<e;)e-=i;for(;r-d<c;)c-=o;for(;c<r+d;){let n=e;for(;n<a+g;)t.drawImage(l,n,c,i,o),n+=i;c+=o}}e(t)})});let d;OVERRIDE(n.clone,e=>{d=n.clone=(n=>{let t={src:c};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})})}}),SkyEngine.Image=CLASS(e=>{return{preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c,a,r=t.src,l=SkyEngine.Util.Collision.checkRectRect,g=!1,d=new Image;d.onload=(()=>{c=d.width,a=d.height,d.onload=void 0,n.fireEvent("load")}),d.src=r;let u;OVERRIDE(n.checkPoint,e=>{u=n.checkPoint=((t,o)=>{if(void 0===i){if(g!==!0){let e=new Image;e.onload=(()=>{let n=e.width,t=e.height,o=CANVAS({style:{display:"none"},width:n,height:t}).appendTo(BODY),c=o.getContext("2d");c.drawImage(e,0,0,n,t),i=c.getImageData(0,0,n,t).data,c=void 0,o.remove(),e.onload=void 0}),e.src=r,g=!0}return e(t,o)===!0}let l=t-n.getDrawingX(),d=o-n.getDrawingY(),u=Math.cos(-n.getRealRadian()),f=Math.sin(-n.getRealRadian()),S=u*l-f*d,s=u*d+f*l;return S=parseInt((S+c*n.getRealScaleX()/2)/n.getRealScaleX()),s=parseInt((s+a*n.getRealScaleY()/2)/n.getRealScaleY()),S>=0&&S<c&&s>=0&&s<a&&i[4*(s*c+S)+3]>20||e(t,o)===!0})});let f;OVERRIDE(n.checkOffScreen,e=>{f=n.checkOffScreen=(t=>{return void 0!==c&&l(0,0,SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),c,a,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e(t)})});let S;OVERRIDE(n.draw,e=>{S=n.draw=(n=>{n.drawImage(d,-c/2,-a/2,c,a),e(n)})});let s;OVERRIDE(n.drawArea,e=>{s=n.drawArea=(n=>{if(void 0===o)if(void 0===i){if(g!==!0){let e=new Image;e.onload=(()=>{let n=e.width,t=e.height,c=CANVAS({style:{display:"none"},width:n,height:t}).appendTo(BODY),a=c.getContext("2d");a.drawImage(e,0,0,n,t),i=a.getImageData(0,0,n,t).data,o=SkyEngine.Util.ImageData.convertImageDataToPolygon(i,n),a=void 0,c.remove(),e.onload=void 0}),e.src=r,g=!0}}else o=SkyEngine.Util.ImageData.convertImageDataToPolygon(i,c);else if(o.length>0){n.moveTo(o[0].x-c/2,o[0].y-a/2);for(let e=1;e<o.length;e+=1){let t=o[e];n.lineTo(t.x-c/2,t.y-a/2)}n.lineTo(o[0].x-c/2,o[0].y-a/2)}e(n)})});let R;OVERRIDE(n.remove,e=>{R=n.remove=(()=>{d=void 0,i=void 0,o=void 0,e()})});let h;OVERRIDE(n.clone,e=>{h=n.clone=(n=>{let t={src:r};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})})}}}),SkyEngine.Silhouette=CLASS(e=>{return{preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c,a=t.src,r=t.color,l=t.border,g=SkyEngine.Util.Collision.checkRectRect;if(void 0!==l){let e=l.split(" ");i=INTEGER(e[0]),o=e[1],c=e[2]}let d,u,f,S,s,R=n.setSrc=(e=>{a=e,d=new Image,d.onload=(()=>{S=d.width,s=d.height;let e=CANVAS({style:{display:"none"},width:S,height:s}).appendTo(BODY),t=e.getContext("2d");t.drawImage(d,0,0,S,s);let i=t.getImageData(0,0,S,s);u=i.data;let o,c=u.length;for(o=0;o<c;o+=4)u[o]=0,u[o+1]=0,u[o+2]=0;d.onload=void 0,t.clearRect(0,0,S,s),t.putImageData(i,0,0),t.globalCompositeOperation="source-in",t.rect(0,0,S,s),t.fillStyle=r,t.fill(),d.src=e.getEl().toDataURL(),i=void 0,t=void 0,e.remove(),void 0!==l&&(f=SkyEngine.Util.ImageData.convertImageDataToPolygon(u,S)),n.fireEvent("load")}),d.src=a});R(a);let h;OVERRIDE(n.checkPoint,e=>{h=n.checkPoint=((t,i)=>{if(void 0===u)return e(t,i)===!0;let o=t-n.getDrawingX(),c=i-n.getDrawingY(),a=Math.cos(-n.getRealRadian()),r=Math.sin(-n.getRealRadian()),l=a*o-r*c,g=a*c+r*o;return l=parseInt((l+S*n.getRealScaleX()/2)/n.getRealScaleX()),g=parseInt((g+s*n.getRealScaleY()/2)/n.getRealScaleY()),l>=0&&l<S&&g>=0&&g<s&&u[4*(g*S+l)+3]>20||e(t,i)===!0})});let E;OVERRIDE(n.checkOffScreen,e=>{E=n.checkOffScreen=(t=>{return void 0!==S&&g(0,0,SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),S,s,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e(t)})});let v;OVERRIDE(n.draw,e=>{v=n.draw=(n=>{if(void 0!==u&&(n.drawImage(d,-S/2,-s/2,S,s),void 0!==l&&f.length>0)){n.beginPath(),n.moveTo(f[0].x-S/2,f[0].y-s/2);for(let e=1;e<f.length;e+=1){let t=f[e];n.lineTo(t.x-S/2,t.y-s/2)}n.lineTo(f[0].x-S/2,f[0].y-s/2),n.lineWidth=i,n.strokeStyle=c,"dashed"===o?n.setLineDash([5]):"dotted"===o&&n.setLineDash([2]),n.stroke(),n.closePath()}e(n)})});let p;OVERRIDE(n.drawArea,e=>{p=n.drawArea=(n=>{if(void 0===f)void 0!==u&&(f=SkyEngine.Util.ImageData.convertImageDataToPolygon(u,S));else if(f.length>0){n.moveTo(f[0].x-S/2,f[0].y-s/2);for(let e=1;e<f.length;e+=1){let t=f[e];n.lineTo(t.x-S/2,t.y-s/2)}n.lineTo(f[0].x-S/2,f[0].y-s/2)}e(n)})});let y;OVERRIDE(n.remove,e=>{y=n.remove=(()=>{d=void 0,u=void 0,f=void 0,e()})});let k;OVERRIDE(n.clone,e=>{k=n.clone=(n=>{let t={src:a,color:r,border:l};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})})}}}),SkyEngine.Sprite=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i,o,c,a,r=t.src,l=t.srcs,g=t.spriteWidth,d=t.spriteHeight,u=t.frameCount,f=t.fps,S=SkyEngine.Util.Collision.checkRectRect,s=0,R=0,h=0,E=!1;void 0===f&&(f=0),void 0!==r&&(i=new Image,i.onload=(()=>{c=i.width,a=i.height,void 0===g&&(g=c),void 0===d&&(d=a),void 0===u&&(u=c/g*a/d),i.onload=void 0,n.fireEvent("load")}),i.src=r),void 0!==l&&EACH(l,e=>{let t=new Image;void 0===o&&(o=[]),t.onload=(()=>{c=t.width,a=t.height,void 0===g&&(g=c),void 0===d&&(d=a),void 0===u?u=1:u+=1,t.onload=void 0,n.fireEvent("load")}),t.src=e,o.push(t)});let v,p=(n.getFrame=(()=>{return R}),n.getBeforeFrame=(()=>{return h}),n.stop=(()=>{E=!0})),y=n.resume=(()=>{E=!1});OVERRIDE(n.hide,e=>{v=n.hide=(()=>{s=0,R=0,h=0,p(),e()})});let k;OVERRIDE(n.show,e=>{k=n.show=(()=>{s=0,R=0,h=0,y(),e()})});let C;OVERRIDE(n.checkOffScreen,e=>{C=n.checkOffScreen=(t=>{return void 0!==c&&S(0,0,SkyEngine.Screen.getWidth(),SkyEngine.Screen.getHeight(),1,1,0,1,n.getDrawingX(),n.getDrawingY(),g,d,n.getRealScaleX(),n.getRealScaleY(),n.getRealSin(),n.getRealCos())!==!0&&e(t)})});let X;OVERRIDE(n.step,e=>{X=n.step=(t=>{E!==!0&&(f>0&&(s+=f*t/1e3),void 0!==u&&s>=u&&(s-=u,n.fireEvent("animationend")),h=R,R=Math.floor(s),R!==h&&n.fireEvent("framechange")),e(t)})});let D;OVERRIDE(n.draw,e=>{D=n.draw=(n=>{if(void 0!==o){if(void 0!==u){let e=o[R];void 0!==e&&n.drawImage(e,-c/2,-a/2,c,a)}}else void 0!==c&&void 0!==a&&void 0!==g&&void 0!==d&&n.drawImage(i,g*Math.floor(s%(c/g)),d*Math.floor(s/(c/g)),g,d,-g/2,-d/2,g,d);e(n)})});let Y;OVERRIDE(n.remove,e=>{Y=n.remove=(()=>{l=void 0,i=void 0,o=void 0,e()})});let w;OVERRIDE(n.clone,e=>{w=n.clone=(n=>{let t={src:r,srcs:l,spriteWidth:g,spriteHeight:d,frameCount:u,fps:f};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})})}}),SkyEngine.CollisionTile=CLASS({preset:()=>{return SkyEngine.Tile}}),SkyEngine.HexagonTileMap=CLASS({preset:()=>{return SkyEngine.TileMap},init:(e,n,t)=>{let i,o=t.overlapHeight;OVERRIDE(n.addTile,e=>{i=n.addTile=(e=>{let t=e.row,i=e.col,c=e.tile,a=e.isCollider,r=n.getCollisionMap(),l=i*n.getTileWidth()+t%2*n.getTileWidth()/2,g=t*(n.getTileHeight()-o);a===!0&&(void 0===r[t]&&(r[t]=[]),r[t][i]=1);let d;d=void 0!==r[t]&&1===r[t][i]?SkyEngine.CollisionTile({x:l,y:g,c:c,collider:SkyEngine.Polygon({points:[{x:0,y:-n.getTileHeight()/2},{x:n.getTileWidth()/2,y:-n.getTileHeight()/4},{x:n.getTileWidth()/2,y:n.getTileHeight()/4},{x:0,y:n.getTileHeight()/2},{x:-n.getTileWidth()/2,y:n.getTileHeight()/4},{x:-n.getTileWidth()/2,y:-n.getTileHeight()/4}]})}):SkyEngine.Tile({x:l,y:g,c:c}),n.append(d)})})}}),SkyEngine.IsometricTileMap=CLASS({preset:()=>{return SkyEngine.TileMap},init:(e,n,t)=>{let i;OVERRIDE(n.addTile,e=>{i=n.addTile=(e=>{let t=e.row,i=e.col,o=e.tile,c=e.isCollider,a=n.getCollisionMap(),r=i*n.getTileWidth()+t%2*n.getTileWidth()/2,l=t*n.getTileHeight()/2;c===!0&&(void 0===a[t]&&(a[t]=[]),a[t][i]=1);let g;g=void 0!==a[t]&&1===a[t][i]?SkyEngine.CollisionTile({x:r,y:l,c:o,collider:SkyEngine.Polygon({points:[{x:0,y:-n.getTileHeight()/2},{x:n.getTileWidth()/2,y:0},{x:0,y:n.getTileHeight()/2},{x:-n.getTileWidth()/2,y:0}]})}):SkyEngine.Tile({x:r,y:l,c:o}),n.append(g)})})}}),SkyEngine.Tile=CLASS({preset:()=>{return SkyEngine.Node}}),SkyEngine.TileMap=CLASS({preset:()=>{return SkyEngine.Node},init:(e,n,t)=>{let i=t.tileWidth,o=t.tileHeight,c=t.collisionMap;void 0===c&&(c=[]);let a;n.getTileWidth=(()=>{return i}),n.getTileHeight=(()=>{return o}),n.addTile=(e=>{let t=e.row,a=e.col,r=e.tile,l=e.isCollider,g=a*i,d=t*o;l===!0&&(void 0===c[t]&&(c[t]=[]),c[t][a]=1);let u;u=void 0!==c[t]&&1===c[t][a]?SkyEngine.CollisionTile({x:g,y:d,c:r,collider:SkyEngine.Rect({width:i,height:o})}):SkyEngine.Tile({x:g,y:d,c:r}),n.append(u)}),n.getCollisionMap=(()=>{return c});OVERRIDE(n.clone,e=>{a=n.clone=(n=>{let t={tileWidth:i,tileHeight:o,collisionMap:c};return void 0!==n&&EXTEND({origin:t,extend:n}),e(t)})});n.findPath=(e=>{let n=e.startRow,t=e.startCol,i=e.endRow,o=e.endCol,a=[],r=[],l=(e,n,t)=>{if(void 0!==c[n]&&0===c[n][t]){void 0===a[n]&&(a[n]=[]);let i=e.cost+1;(void 0===a[n][t]||a[n][t]>i)&&(a[n][t]=i,r.push({parent:e,row:n,col:t,cost:i}))}};for(l({cost:-1},n,t);r.length>0;){let e=r.shift();if(e.row===i&&e.col===o){let n=[],t=e;for(;t.cost>=0;)n.unshift({row:t.row,col:t.col}),t=t.parent;return n}l(e,e.row-1,e.col),l(e,e.row,e.col+1),l(e,e.row+1,e.col),l(e,e.row,e.col-1)}})},afterInit:(e,n,t)=>{let i=t.tileMap,o=t.tileKeySet,c=t.tileKeyMap;void 0!==i&&(EACH(i,(e,t)=>{EACH(e,(e,i)=>{void 0!==e&&n.addTile({row:t,col:i,tile:e})})}),i=void 0),void 0!==c&&(EACH(c,(e,t)=>{EACH(e,(e,i)=>{let c=o[e];void 0!==c&&n.addTile({row:t,col:i,tile:c.clone()})})}),c=void 0)}}),SkyEngine("Util").Collision=OBJECT({init:(e,n)=>{let t=(e,n,t)=>{return(n-e)*(t-e)<=0},i=n.checkPointInRect=((e,n,i,o,c,a,r,l,g,d)=>{e-=i,n-=o;let u=i+d*e+g*n,f=o-g*e+d*n;return c*=r,a*=l,i-=c/2,o-=a/2,t(u,i,i+c)===!0&&t(f,o,o+a)===!0}),o=n.checkPointInCircle=((e,n,t,i,o,c,a,r,l,g)=>{e-=t,n-=i,o*=a,c*=r;let d=2*(g*e+l*n)/o,u=2*(l*e-g*n)/c;return d*d+u*u<=1}),c=n.checkPointInPolygon=((e,n,t,i,o,c,a,r,l)=>{e-=t,n-=i;let g=t+l*e+r*n,d=i-r*e+l*n;g-=t,d-=i;let u=!1,f=o.length;for(let S=0,s=f-1;S<f;s=S,S+=1){let e=o[S].x*c,n=o[S].y*a,t=o[s].x*c,i=o[s].y*a;n>d!=i>d&&g<(t-e)*(d-n)/(i-n)+e&&(u=!u)}return u}),a=n.checkLineLine=((e,n,t,i,o,c,a,r,l,g,d,u,f,S,s,R,h,E,v,p)=>{t*=a,i*=r;let y=e+g*t+l*i,k=n+l*t+g*i;o*=a,c*=r;let C=e+g*o+l*c,X=n+l*o+g*c;f*=h,S*=E;let D=d+p*f+v*S,Y=u+v*f+p*S;s*=h,R*=E;let w=d+p*s+v*R,I=u+v*s+p*R,m=(C-y)*(I-Y)-(w-D)*(X-k);if(0===m)return!1;{let e=((I-Y)*(w-y)+(D-w)*(I-k))/m,n=((k-X)*(w-y)+(C-y)*(I-k))/m;return 0<=e&&e<=1&&0<=n&&n<=1}}),r=(n.checkLineRect=((e,n,t,o,c,r,l,g,d,u,f,S,s,R,h,E,v,p)=>{t*=l,o*=g;let y=e+u*t+d*o,k=n+d*t+u*o;if(i(y,k,f,S,s,R,h,E,v,p)===!0)return!0;c*=l,r*=g;let C=e+u*c+d*r,X=n+d*c+u*r;if(i(C,X,f,S,s,R,h,E,v,p)===!0)return!0;let D,Y,w,I,m,A,T,x;s*=h/2,R*=E/2;let M=p*s,O=p*R,P=-v*s,H=-v*R;return D=f-M-H,Y=S+P-O,w=f+M-H,I=S-P-O,m=f+M+H,A=S-P+O,T=f-M+H,x=S+P+O,a(0,0,y,k,C,X,1,1,0,1,0,0,D,Y,w,I,1,1,0,1)===!0||a(0,0,y,k,C,X,1,1,0,1,0,0,w,I,m,A,1,1,0,1)===!0||a(0,0,y,k,C,X,1,1,0,1,0,0,m,A,T,x,1,1,0,1)===!0||a(0,0,y,k,C,X,1,1,0,1,0,0,T,x,D,Y,1,1,0,1)===!0}),n.checkLineCircle=((e,n,i,c,a,l,g,d,u,f,S,s,R,h,E,v,p,y)=>{i*=g,c*=d;let k=e+f*i+u*c,C=n+u*i+f*c;if(o(k,C,S,s,R,h,E,v,p,y)===!0)return!0;a*=g,l*=d;let X=e+f*a+u*l,D=n+u*a+f*l;if(o(X,D,S,s,R,h,E,v,p,y)===!0)return!0;k-=S,C-=s,X-=S,D-=s;let Y=y*k+p*C,w=-p*k+y*C,I=y*X+p*D,m=-p*X+y*D;R*=E,h*=v;let A=(m-w)/(I-Y);if(Math.abs(A)>1024)return r(0,0,w,Y,m,I,1,1,0,1,0,0,h,R,1,1,0,1);if(o(I,m,0,0,R,h,1,1,0,1)===!0)return!0;let T=R*R/4,x=h*h/4,M=w-A*Y,O=1/T+A*A/x,P=2*A*M/x,H=M*M/x-1,V=P*P-4*O*H;return!(V<0)&&(V=Math.sqrt(V),O*=2,t((-P-V)/O,Y,I)===!0||t((-P+V)/O,Y,I)===!0)}));n.checkLinePolygon=((e,n,t,i,o,r,l,g,d,u,f,S,s,R,h,E,v)=>{t*=l,i*=g;let p=e+u*t+d*i,y=n+d*t+u*i;if(c(p,y,f,S,s,R,h,E,v)===!0)return!0;o*=l,r*=g;let k=e+u*o+d*r,C=n+d*o+u*r;if(c(k,C,f,S,s,R,h,E,v)===!0)return!0;let X=s.length;for(let D=0,Y=X-1;D<X;Y=D,D+=1){let e=s[D].x*R,n=s[D].y*h,t=s[Y].x*R,i=s[Y].y*h,o=f+v*e-E*n,c=S+E*e+v*n,r=f+v*t-E*i,l=S+E*t+v*i;if(a(0,0,p,y,k,C,1,1,0,1,0,0,o,c,r,l,1,1,0,1)===!0)return!0}return!1}),n.checkRectRect=((e,n,t,o,c,r,l,g,d,u,f,S,s,R,h,E)=>{t*=c,o*=r,f*=s,S*=R;let v,p,y,k,C,X,D,Y,w=g*t/2,I=g*o/2,m=-l*t/2,A=-l*o/2;if(v=e-w-A,p=n+m-I,y=e+w-A,k=n-m-I,C=e+w+A,X=n-m+I,D=e-w+A,Y=n+m+I,i(v,p,d,u,f,S,1,1,h,E)===!0||i(y,k,d,u,f,S,1,1,h,E)===!0||i(C,X,d,u,f,S,1,1,h,E)===!0||i(D,Y,d,u,f,S,1,1,h,E)===!0)return!0;let T,x,M,O,P,H,V,N,L=E*f/2,W=E*S/2,F=-h*f/2,U=-h*S/2;return T=d-L-U,x=u+F-W,M=d+L-U,O=u-F-W,P=d+L+U,H=u-F+W,V=d-L+U,N=u+F+W,i(T,x,e,n,t,o,1,1,l,g)===!0||i(M,O,e,n,t,o,1,1,l,g)===!0||i(P,H,e,n,t,o,1,1,l,g)===!0||i(V,N,e,n,t,o,1,1,l,g)===!0||(a(0,0,v,p,y,k,1,1,0,1,0,0,T,x,M,O,1,1,0,1)===!0||a(0,0,v,p,y,k,1,1,0,1,0,0,M,O,P,H,1,1,0,1)===!0||a(0,0,v,p,y,k,1,1,0,1,0,0,P,H,V,N,1,1,0,1)===!0||a(0,0,v,p,y,k,1,1,0,1,0,0,V,N,T,x,1,1,0,1)===!0||a(0,0,y,k,C,X,1,1,0,1,0,0,T,x,M,O,1,1,0,1)===!0||a(0,0,y,k,C,X,1,1,0,1,0,0,M,O,P,H,1,1,0,1)===!0||a(0,0,y,k,C,X,1,1,0,1,0,0,P,H,V,N,1,1,0,1)===!0||a(0,0,y,k,C,X,1,1,0,1,0,0,V,N,T,x,1,1,0,1)===!0||a(0,0,C,X,D,Y,1,1,0,1,0,0,T,x,M,O,1,1,0,1)===!0||a(0,0,C,X,D,Y,1,1,0,1,0,0,M,O,P,H,1,1,0,1)===!0||a(0,0,C,X,D,Y,1,1,0,1,0,0,P,H,V,N,1,1,0,1)===!0||a(0,0,C,X,D,Y,1,1,0,1,0,0,V,N,T,x,1,1,0,1)===!0||a(0,0,D,Y,v,p,1,1,0,1,0,0,T,x,M,O,1,1,0,1)===!0||a(0,0,D,Y,v,p,1,1,0,1,0,0,M,O,P,H,1,1,0,1)===!0||a(0,0,D,Y,v,p,1,1,0,1,0,0,P,H,V,N,1,1,0,1)===!0||a(0,0,D,Y,v,p,1,1,0,1,0,0,V,N,T,x,1,1,0,1)===!0)}),n.checkRectCircle=((e,n,t,c,a,l,g,d,u,f,S,s,R,h,E,v)=>{if(i(u,f,e,n,t,c,a,l,g,d)===!0)return!0;let p,y,k,C,X,D,Y,w;t*=a/2,c*=l/2;let I=d*t,m=d*c,A=-g*t,T=-g*c;return p=e-I-T,y=n+A-m,k=e+I-T,C=n-A-m,X=e+I+T,D=n-A+m,Y=e-I+T,w=n+A+m,o(p,y,u,f,S,s,R,h,E,v)===!0||o(k,C,u,f,S,s,R,h,E,v)===!0||o(X,D,u,f,S,s,R,h,E,v)===!0||o(Y,w,u,f,S,s,R,h,E,v)===!0||(S*=R,s*=h,r(0,0,p,y,k,C,1,1,0,1,u,f,S,s,1,1,E,v)===!0||r(0,0,k,C,X,D,1,1,0,1,u,f,S,s,1,1,E,v)===!0||r(0,0,X,D,Y,w,1,1,0,1,u,f,S,s,1,1,E,v)===!0||r(0,0,Y,w,p,y,1,1,0,1,u,f,S,s,1,1,E,v)===!0)}),n.checkRectPolygon=((e,n,t,o,r,l,g,d,u,f,S,s,R,h,E)=>{t*=r,o*=l;let v,p,y,k,C,X,D,Y,w=d*t/2,I=d*o/2,m=-g*t/2,A=-g*o/2;if(v=e-w-A,p=n+m-I,y=e+w-A,k=n-m-I,C=e+w+A,X=n-m+I,D=e-w+A,Y=n+m+I,c(v,p,u,f,S,s,R,h,E)===!0||c(y,k,u,f,S,s,R,h,E)===!0||c(C,X,u,f,S,s,R,h,E)===!0||c(D,Y,u,f,S,s,R,h,E)===!0)return!0;let T=S.length;for(let x=0,M=T-1;x<T;M=x,x+=1){let c=S[x].x*s,r=S[x].y*R,l=u+E*c-h*r,w=f+h*c+E*r;if(i(l,w,e,n,t,o,1,1,g,d)===!0)return!0;let I=S[M].x*s,m=S[M].y*R,A=u+E*I-h*m,T=f+h*I+E*m;if(a(0,0,v,p,y,k,1,1,0,1,0,0,l,w,A,T,1,1,0,1)===!0||a(0,0,y,k,C,X,1,1,0,1,0,0,l,w,A,T,1,1,0,1)===!0||a(0,0,C,X,D,Y,1,1,0,1,0,0,l,w,A,T,1,1,0,1)===!0||a(0,0,D,Y,v,p,1,1,0,1,0,0,l,w,A,T,1,1,0,1)===!0)return!0}return!1}),n.checkCircleCircle=((e,n,t,i,c,a,r,l,g,d,u,f,S,s,R,h)=>{t*=c,i*=a,u*=S,f*=s,g-=e,d-=n,e=n=0;let E=((t>i?t:i)+(u>f?u:f))/2;if(g*g+d*d>E*E)return!1;if(o(g,d,e,n,t,i,1,1,r,l)===!0||o(e,n,g,d,u,f,1,1,R,h)===!0)return!0;let v=l*e+r*n,p=-r*e+l*n;r=-r;let y=t*t/4,k=i*i/4,C=l*l/y+r*r/k,X=-2*l*r/y+2*l*r/k,D=r*r/y+l*l/k,Y=-2*v*l/y-2*p*r/k,w=2*v*r/y-2*p*l/k,I=v*v/y+p*p/k-1;v=h*g+R*d,p=-R*g+h*d,R=-R,y=u*u/4,k=f*f/4;let m=h*h/y+R*R/k,A=-2*h*R/y+2*h*R/k,T=R*R/y+h*h/k,x=-2*v*h/y-2*p*R/k,M=2*v*R/y-2*p*h/k,O=v*v/y+p*p/k-1,P=I*C*x*x+C*C*O*O-Y*C*x*O+m*m*I*I-2*C*O*m*I-Y*x*m*I+m*Y*Y*O,H=M*Y*Y*m-O*x*C*X-2*C*O*m*w-I*m*A*Y+2*x*A*C*I+2*M*O*C*C+x*x*C*w-M*x*C*Y-2*C*M*m*I-I*m*x*X+2*I*w*m*m-O*A*C*Y-w*m*x*Y+2*O*X*m*k,V=M*M*C*C+2*T*O*C*C-w*m*x*X+O*m*X*X-w*m*A*Y-O*A*C*X-2*C*M*m*w+2*x*A*C*w-T*x*C*Y-2*C*T*m*I+A*A*C*I+2*M*X*m*Y+w*w*m*m-D*m*x*Y-M*A*C*Y+2*I*D*m*m-I*m*A*X+T*Y*Y*m+x*x*C*D-M*x*C*X-2*C*O*m*p,N=-2*C*m*D*M+M*m*X*X+2*T*X*m*Y-D*m*A*Y+A*A*C*w-M*A*C*X-2*C*T*m*w-w*m*A*X-T*A*C*Y+2*M*T*C*C+2*w*D*m*m-D*m*x*X+2*x*A*C*D-T*x*C*y,L=C*C*T*T-2*C*T*m*D+m*m*D*D-X*C*A*T-X*A*m*D+X*X*m*T+D*C*A*A;if(0===P)return!0;if(0===L)return 0!==N||(0!==V?H*H-4*V*P>=0:0!==H);let W=N/L,F=V/L,U=H/L,b=P/L,_=(8*F-3*W*W)/8,B=(W*W*W-4*W*F+8*U)/8,K=(-3*W*W*W*W+256*b-64*U*W+16*W*W*F)/256,q=256*K*K*K-128*_*_*K*K+144*_*B*B*K-27*B*B*B*B+16*_*_*_*_*K-4*_*_*_*B*B,Z=8*_,z=64*K-16*_*_;return q<0||q>0&&Z<0&&z<0||0===q&&(0!==z||Z<=0)}),n.checkCirclePolygon=((e,n,t,i,a,l,g,d,u,f,S,s,R,h,E)=>{if(c(e,n,u,f,S,s,R,h,E)===!0)return!0;t*=a,i*=l;let v=S.length;for(let p=0,y=v-1;p<v;y=p,p+=1){let c=S[p].x*s,a=S[p].y*R,l=u+E*c-h*a,v=f+h*c+E*a;if(o(l,v,e,n,t,i,1,1,g,d)===!0)return!0;let k=S[y].x*s,C=S[y].y*R,X=u+E*k-h*C,D=f+h*k+E*C;if(r(0,0,l,v,X,D,1,1,0,1,e,n,t,i,1,1,g,d)===!0)return!0}return!1}),n.checkPolygonPolygon=((e,n,t,i,o,r,l,g,d,u,f,S,s,R)=>{let h=t.length,E=u.length;for(let v=0,p=E-1;v<E;p=v,v+=1){let a=u[v].x*f,h=u[v].y*S,E=g+R*a-s*h,p=d+s*a+R*h;if(c(E,p,e,n,t,i,o,r,l)===!0)return!0}for(let v=0,p=h-1;v<h;p=v,v+=1){let h=t[v].x*i,y=t[v].y*o,k=e+l*h-r*y,C=n+r*h+l*y;if(c(k,C,g,d,u,f,S,s,R)===!0)return!0;let X=t[p].x*i,D=t[p].y*o,Y=e+l*X-r*D,w=n+r*X+l*D;for(let I=0,m=E-1;I<E;m=I,I+=1){let e=u[I].x*f,n=u[I].y*S,t=g+R*e-s*n,i=d+s*e+R*n,o=u[m].x*f,c=u[m].y*S,r=g+R*o-s*c,l=d+s*o+R*c;if(a(0,0,k,C,Y,w,1,1,0,1,0,0,t,i,r,l,1,1,0,1)===!0)return!0}}return!1})}}),SkyEngine("Util").ImageData=OBJECT({init:(e,n)=>{const t=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1],i=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0];let o=n.checkImageDataPointIsTransparent=((e,n,t,i)=>{return e[4*(i*n+t)+3]<=20});n.convertImageDataToPolygon=((e,n)=>{let c,a,r,l,g=0,d=0,u=[];for(;;){if(o(e,n,g,d)!==!0){r=g,l=d;break}0===g?(g=d+1,d=0):(g-=1,d+=1)}g=r,d=l;let f=0,S=0;do{let r=0;if(o(e,n,g-1,d-1)!==!0&&(r+=1),o(e,n,g,d-1)!==!0&&(r+=2),o(e,n,g-1,d)!==!0&&(r+=4),o(e,n,g,d)!==!0&&(r+=8),6===r)f=a===-1?-1:1,S=0;else if(9===r)f=0,S=1===c?-1:1;else{if(!(r<15))break;f=t[r],S=i[r]}if(f!==c&&S!==a&&(u.push({x:g,y:d}),c=f,a=S),g+=f,d+=S,g<0||d<0)break}while(r!==g||l!==d);return u})}});